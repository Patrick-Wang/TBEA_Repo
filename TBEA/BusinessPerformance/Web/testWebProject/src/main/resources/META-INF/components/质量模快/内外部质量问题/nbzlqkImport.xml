<components>
 <service id="servNbzlqkEntry" transaction="transactionManager">
  <context key="counter" value="${counterFactory.newCounter}"/>
  <context key="counterSerial" value="${counterFactory.newCounter.reset[0]}"/>
  <merge data="${data}" table="zl_nbyclzlwt">
   <where>
    <serial_num type="string" value="${gs + counterSerial.next.format[8]}"/>
   </where>
   <set>
    <company_name type="string" ref="${counter.reset[0].val}"/>
    <issue_happen_date type="date" ref="${counter.next.val}"/>
    <product_type type="string" ref="${counter.next.val}"/>
    <production_num type="string" ref="${counter.next.val}"/>
    <production_model type="string" ref="${counter.next.val}"/>
    <issue_type type="string" ref="${counter.next.val}"/>
    <sub_issue_type type="string" ref="${counter.next.val}"/>
    <category_code type="string" ref="${counter.next.val}"/>
    <material_quality_phenomenon type="string" ref="${counter.next.val}"/>
    <detail type="string" ref="${counter.next.val}"/>
    <material_happen_phase type="string" ref="${counter.next.val}"/>
    <material_count type="double" ref="${counter.next.val}"/>
    <measurement_units type="string" ref="${counter.next.val}"/>
    <suppier type="string" ref="${counter.next.val}"/>
    <issue_process type="string" ref="${counter.next.val}"/>
    <responsibility_department type="string" ref="${counter.next.val}"/>
    <material_treatment_measure type="string" ref="${counter.next.val}"/>
    <onsite_treatmen_measure type="string" ref="${counter.next.val}"/>
    <onsite_treatment_result type="string" ref="${counter.next.val}"/>
    <causa_analysis type="string" ref="${counter.next.val}"/>
    <assessment type="string" ref="${counter.next.val}"/>
    <filling_personnel type="string" ref="${counter.next.val}"/>
    <source type="string" value="${src}"/>
    <time type="date" value="${time}"/>
    <zt type="int" value="2"/>
   </set>
  </merge>
 </service>
 <controller id="nbzlqkImport">
  <context key="data" value="${request.upfile.asExcel}"/>
  <context key="src" value="${session.account.name} Excel 导入"/>
  <context key="time" value="${calendar.current.secondFormat}"/>
  <callservice id="servNbzlqkEntry"/>
  <response type="json">
   <errorCode>0</errorCode>
   <message>OK</message>
  </response>
 </controller>
 <controller id="nbzlqkImportJsp">
  <response type="jsp" name="components/import_data">
   <map key="importUrl" value="nbzlqkImport"/>
   <map key="title" value="内部质量情况导入"/>
  </response>
 </controller>
 <service id="servNbzlqkTrans" transaction="transactionManager">
  <sql>delete from zl_nbyclzlwt where source = ${src}</sql>
  <callservice id="servNbzlqkEntry"/>
 </service>
 <controller id="nbzlqkTransport" cron1="0 0 0 3-5 * ?">
  <context key="time" value="${calendar.current.secondFormat}"/>
  <callservice id="servNbzlqkTransLl"/>
  <response type="json">
   <errorCode>0</errorCode>
   <message>OK</message>
  </response>
 </controller>
 <service id="servNbzlqkTransLl" transaction="transLl">
  <context key="src" value="鲁缆数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
 <service id="servNbzlqkTransXl" transaction="transXl">
  <context key="src" value="新缆数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
 <service id="servNbzlqkTransDl" transaction="transDl">
  <context key="src" value="德缆数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
 <service id="servNbzlqkTransSb" transaction="transSb">
  <context key="src" value="沈变数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
 <service id="servNbzlqkTransHb" transaction="transHb">
  <context key="src" value="衡变数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
 <service id="servNbzlqkTransXb" transaction="transXb">
  <context key="src" value="新变数据库收集"/>
  <sql id="data" export="true">select * from zl_nbyclzlwt</sql>
  <callservice id="servNbzlqkTrans"/>
 </service>
</components>
