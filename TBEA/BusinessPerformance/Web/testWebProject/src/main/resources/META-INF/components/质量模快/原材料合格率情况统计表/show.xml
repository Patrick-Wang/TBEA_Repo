<components>
 <service id="servByqzyYclhglqktj" transaction="transactionManager">
  <sql id="clids">select
 CLDL.id,
 CLDL.name,
 CLDL.dw
from
 zl_yclhglqk_cldl CLDL</sql>
  <list id="ids" type="int" sql="clids" value="0"/>
  <sql id="sbdyz" order="ids" by="0">select
 CLDL.id,
 YCL.hgs,
 YCL.zs,
 (YCL.zs - YCL.hgs) / YCL.zs as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 YCL.nf=${cal.year} and
 YCL.yf=${cal.month} and
 YCL.dwid=1</sql>
  <sql id="sbljz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as newHgs,
 sum(YCL.zs) as newZs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.months[1].date}) &lt;= 0 and 
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.date}) &gt;= 0 and 
 YCL.dwid=1
group by
 CLDL.id</sql>
  <sql id="hbdyz" order="ids" by="0">select
 CLDL.id,
 YCL.hgs,
 YCL.zs,
 (YCL.zs - YCL.hgs) / YCL.zs as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 YCL.nf=${cal.year} and
 YCL.yf=${cal.month} and
 YCL.dwid=2</sql>
  <sql id="hbljz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as newHgs,
 sum(YCL.zs) as newZs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.months[1].date}) &lt;= 0 and 
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.date}) &gt;= 0 and 
 YCL.dwid=2
group by
 CLDL.id</sql>
  <sql id="xbdyz" order="ids" by="0">select
 CLDL.id,
 YCL.hgs,
 YCL.zs,
 (YCL.zs - YCL.hgs) / YCL.zs as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 YCL.nf=${cal.year} and
 YCL.yf=${cal.month} and
 YCL.dwid=3</sql>
  <sql id="xbljz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as newHgs,
 sum(YCL.zs) as newZs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.months[1].date}) &lt;= 0 and 
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.date}) &gt;= 0 and 
 YCL.dwid=3
group by
 CLDL.id</sql>
  <sql id="hjdyz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as hgs,
 sum(YCL.zs) as zs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 YCL.nf=${cal.year} and
 YCL.yf=${cal.month} and
 YCL.dwid in (1,2,3)
group by
 CLDL.id</sql>
  <sql id="hjljz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as newHgs,
 sum(YCL.zs) as newZs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.months[1].date}) &lt;= 0 and 
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.date}) &gt;= 0 and 
 YCL.dwid in (1,2,3)
group by
 CLDL.id</sql>
  <list id="dyzOrdered" type="int" sql="dyz" value="0"/>
  <table id="result" rowIds="ids">
   <list type="string" sql="clids" value="1"/>
   <list type="string" sql="clids" value="2"/>
   <list type="int" sql="sbdyz" value="1"/>
   <list type="int" sql="sbdyz" value="2"/>
   <list type="double" sql="sbdyz" value="3"/>
   <list type="int" sql="sbljz" value="1"/>
   <list type="int" sql="sbljz" value="2"/>
   <list type="double" sql="sbljz" value="3"/>
   <list type="int" sql="hbdyz" value="1"/>
   <list type="int" sql="hbdyz" value="2"/>
   <list type="double" sql="hbdyz" value="3"/>
   <list type="int" sql="hbljz" value="1"/>
   <list type="int" sql="hbljz" value="2"/>
   <list type="double" sql="hbljz" value="3"/>
   <list type="int" sql="xbdyz" value="1"/>
   <list type="int" sql="xbdyz" value="2"/>
   <list type="double" sql="xbdyz" value="3"/>
   <list type="int" sql="xbljz" value="1"/>
   <list type="int" sql="xbljz" value="2"/>
   <list type="double" sql="xbljz" value="3"/>
   <list type="int" sql="hjdyz" value="1"/>
   <list type="int" sql="hjdyz" value="2"/>
   <list type="double" sql="hjdyz" value="3"/>
   <list type="int" sql="hjljz" value="1"/>
   <list type="int" sql="hjljz" value="2"/>
   <list type="double" sql="hjljz" value="3"/>
  </table>
  <context key="result" value="${result}"/>
 </service>
 <service id="servByqjydwzyYclhglqktj" transaction="transactionManager">
  <sql id="clids">select
 CLDL.id,
 CLDL.name,
 CLDL.dw
from
 zl_yclhglqk_cldl CLDL</sql>
  <list id="ids" type="int" sql="clids" value="0"/>
  <sql id="dyz" order="ids" by="0">select
 CLDL.id,
 YCL.hgs,
 YCL.zs,
 (YCL.zs - YCL.hgs) / YCL.zs as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 YCL.nf=${cal.date.year} and
 YCL.yf=${cal.date.month} and
 YCL.dwid=${compId}</sql>
  <sql id="ljz" order="ids" by="0">select
 CLDL.id,
 sum(YCL.hgs) as newHgs,
 sum(YCL.zs) as newZs,
 (sum(YCL.zs) - sum(YCL.hgs)) / sum(YCL.zs) as hgl
from
 zl_yclhglqk_cldl CLDL,
 zl_yclhglqk YCL
where
 YCL.clid=CLDL.id and
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.months[1].date}) &lt;= 0 and 
 dateDiff(mm, dateadd(mm, YCL.yf - 1, dateadd(yy, YCL.nf -1900 ,'1900-1-1')), ${cal.date}) &gt;= 0 and 
 YCL.dwid=${compId}
group by
 CLDL.id</sql>
  <list id="dyzOrdered" type="int" sql="dyz" value="0"/>
  <table id="result" rowIds="ids">
   <list type="string" sql="clids" value="1"/>
   <list type="string" sql="clids" value="2"/>
   <list type="int" sql="dyz" value="1"/>
   <list type="int" sql="dyz" value="2"/>
   <list type="double" sql="dyz" value="3"/>
   <list type="int" sql="ljz" value="1"/>
   <list type="int" sql="ljz" value="2"/>
   <list type="double" sql="ljz" value="3"/>
  </table>
  <context key="result" value="${result}"/>
 </service>
 <controller id="byqjydwzyYclhglqktjDataFmtter">
  <formatter id="data">
   <EmptyFormatter>
    <DefaultMatcher cols="0,1"/>
   </EmptyFormatter>
   <PercentFormatter reservedCount="1">
    <DefaultMatcher cols="4,7"/>
   </PercentFormatter>
   <NumberFormatter reservedCount="0"/>
  </formatter>
 </controller>
 <controller id="byqzyYclhglqktjDataFmtter">
  <formatter id="data">
   <EmptyFormatter>
    <DefaultMatcher cols="0,1"/>
   </EmptyFormatter>
   <PercentFormatter reservedCount="1">
    <DefaultMatcher cols="4,7,10,13,16,19"/>
   </PercentFormatter>
   <NumberFormatter reservedCount="0"/>
  </formatter>
 </controller>
 <controller id="byqjydwzyYclhglqktjUpdate">
  <context key="cal" value="${request.date.asCalendar}"/>
  <if test="${[50000,50001].indexOf(orgIdByType.virtualCYOrg[request.item.asInt]) &gt;= 0}">
   <callcontroller id="byqzyYclhglqktjDataFmtter" inline="true"/>
   <callservice id="servByqzyYclhglqktj"/>
   <formatterServer id="serv" table="${result.matrixNoIds}">
    <formatter ref="data"/>
   </formatterServer>
   <response type="json">
    <header type="array">
     <item>
      <name>材料大类</name>
     </item>
     <item>
      <name>单位</name>
     </item>
     <item>
      <name>沈变</name>
      <sub type="array">
       <item>
        <name>当月</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
       <item>
        <name>年度累计</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
      </sub>
     </item>
     <item>
      <name>衡变</name>
      <sub type="array">
       <item>
        <name>当月</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
       <item>
        <name>年度累计</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
      </sub>
     </item>
     <item>
      <name>新变</name>
      <sub type="array">
       <item>
        <name>当月</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
       <item>
        <name>年度累计</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
      </sub>
     </item>
     <item>
      <name>合计</name>
      <sub type="array">
       <item>
        <name>当月</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
       <item>
        <name>年度累计</name>
        <sub type="array">
         <item>
          <name>合格数</name>
         </item>
         <item>
          <name>总数</name>
         </item>
         <item>
          <name>合格率％</name>
         </item>
        </sub>
       </item>
      </sub>
     </item>
    </header>
    <mergeTitle type="array">true</mergeTitle>
    <data>${serv.result}</data>
   </response>
  </if>
  <if test="${[50000,50001].indexOf(orgIdByType.virtualCYOrg[request.item.asInt]) &lt; 0}">
   <context key="compId" value="${request.item.asInt}"/>
   <callservice id="servByqjydwzyYclhglqktj"/>
   <callcontroller id="byqjydwzyYclhglqktjDataFmtter" inline="true"/>
   <formatterServer id="serv" table="${result.matrixNoIds}">
    <formatter ref="data"/>
   </formatterServer>
   <response type="json">
    <header type="array">
     <item>
      <name>材料大类</name>
     </item>
     <item>
      <name>单位</name>
     </item>
     <item>
      <name>当月</name>
      <sub type="array">
       <item>
        <name>合格数</name>
       </item>
       <item>
        <name>总数</name>
       </item>
       <item>
        <name>合格率％</name>
       </item>
      </sub>
     </item>
     <item>
      <name>年度累计</name>
      <sub type="array">
       <item>
        <name>合格数</name>
       </item>
       <item>
        <name>总数</name>
       </item>
       <item>
        <name>合格率％</name>
       </item>
      </sub>
     </item>
    </header>
    <mergeTitle type="array">true</mergeTitle>
    <data>${serv.result}</data>
   </response>
  </if>
 </controller>
 <controller id="yclhglqktjExport">
  <context key="cal" value="${request.date.asCalendar}"/>
  <ExcelTemplate id="excelTemplate" sheet="原材料合格率"/>
  <if test="${[50000,50001].indexOf(request.item.asInt) &lt; 0}">
   <callcontroller id="byqzyYclhglqktjDataFmtter" inline="true"/>
   <callservice id="servByqzyYclhglqktj"/>
   <list id="title" type="string">材料大类,单位,
沈变,沈变,沈变,沈变,沈变,沈变,
衡变,衡变,衡变,衡变,衡变,衡变,
新变,新变,新变,新变,新变,新变,
合计,合计,合计,合计,合计,合计
		</list>
   <list id="title1" type="string">材料大类,单位,
当月,当月,当月,年度累计,年度累计,年度累计,
当月,当月,当月,年度累计,年度累计,年度累计,
当月,当月,当月,年度累计,年度累计,年度累计,
当月,当月,当月,年度累计,年度累计,年度累计
		</list>
   <list id="title2" type="string">材料大类,单位,
合格数,总数,合格率％,合格数,总数,合格率％,
合格数,总数,合格率％,合格数,总数,合格率％,
合格数,总数,合格率％,合格数,总数,合格率％,
合格数,总数,合格率％,合格数,总数,合格率％</list>
   <formatter id="excel">
    <ExcelTitleFilter>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="0" col="0"/>
     <titles>
      <title ref="title"/>
      <title ref="title1"/>
      <title ref="title2"/>
     </titles>
    </ExcelTitleFilter>
    <ExcelMergeFormatter>
     <ExcelTemplate ref="excelTemplate"/>
     <MergeRegion x="0" y="0" width="${title.size}" height="3"/>
    </ExcelMergeFormatter>
    <ExcelHeaderCenterFormatter>
     <DefaultMatcher cols="0, 1"/>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="3" col="0"/>
    </ExcelHeaderCenterFormatter>
    <ExcelOffsetFormatter>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="3" col="0"/>
    </ExcelOffsetFormatter>
   </formatter>
  </if>
  <if test="${[50000,50001].indexOf(request.item.asInt) &gt;= 0}">
   <context key="compId" value="${request.item.asInt}"/>
   <callservice id="servByqjydwzyYclhglqktj"/>
   <callcontroller id="byqjydwzyYclhglqktjDataFmtter" inline="true"/>
   <list id="title" type="string">材料大类,单位,当月,当月,当月,年度累计,年度累计,年度累计
		</list>
   <list id="title1" type="string">材料大类,单位,合格数,总数,合格率％,合格数,总数,合格率％
		</list>
   <formatter id="excel">
    <ExcelTitleFilter>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="0" col="0"/>
     <titles>
      <title ref="title"/>
      <title ref="title1"/>
     </titles>
    </ExcelTitleFilter>
    <ExcelMergeFormatter>
     <ExcelTemplate ref="excelTemplate"/>
     <MergeRegion x="0" y="0" width="8" height="2"/>
    </ExcelMergeFormatter>
    <ExcelHeaderCenterFormatter>
     <DefaultMatcher cols="0, 1"/>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="2" col="0"/>
    </ExcelHeaderCenterFormatter>
    <ExcelOffsetFormatter>
     <ExcelTemplate ref="excelTemplate"/>
     <Offset row="2" col="0"/>
    </ExcelOffsetFormatter>
   </formatter>
  </if>
  <formatterServer id="serv" table="${result.matrixNoIds}">
   <formatter ref="data"/>
   <formatter ref="excel"/>
  </formatterServer>
  <response type="excel" ref="excelTemplate" name="${cal.format}原材料合格率.xls" serv="serv"/>
 </controller>
 <controller id="yclhglqktj">
  <response type="jsp" name="framework/templates/dateReport/show">
   <map key="year" value="${calendar.current.year}"/>
   <map key="month" value="${calendar.current.month}"/>
   <map key="updateUrl" value="byqjydwzyYclhglqktjUpdate"/>
   <map key="exportUrl" value="byqjydwzyYclhglqktjExport"/>
   <map key="title" value="原材料合格率"/>
   <map map="${authMgr[43]}"/>
  </response>
 </controller>
</components>
